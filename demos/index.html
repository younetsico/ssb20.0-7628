<html>
<head>
  <title>SecureBlackbox 2020 Demos - DC PDF Signer</title>
  <meta name="description" content="SecureBlackbox 2020 Demos - DC PDF Signer">
</head>
<body>

<div id="content">
<h1>SecureBlackbox - DC Demo</h1>
<h2>DC PDF Signer</h2>
<p>Use this demo to learn how to create signed PDF documents using DC.</p>
<hr/>

<style>
#highlight{background-image:url(spotlights.png)}#header{background-image:url(header.png)}#header .pipelist li{border-left:1px solid #1a72b9}#header .pipelist a{color:#1a72b9}#header .logo{background:url(logo.png);width:150px;height:50px;top:18px}body,html{height:100%}body,h1,h2,h3,li,p,td{font-family:'Segoe UI',Verdana,Arial}body{color:#000;margin:0;padding:0;font-size:.8em;width:100%}#wrapper{min-height:100%;height:auto!important;height:100%;margin:0 auto -30px}#footer,.push{height:30px}#highlight{background-repeat:no-repeat;background-position:top left;width:100%;height:60px}#header{width:100%;height:60px;background-repeat:repeat-x;background-position:top left;position:relative}#header .logo{background-repeat:no-repeat;background-position:top left;text-indent:-9999px;overflow:hidden;left:15px;position:absolute;-ms-interpolation-mode:bicubic}#header .pipelist{overflow:hidden;margin-right:-5px;position:absolute;bottom:5px;right:10px;font-size:.85em}#header .pipelist ul{list-style-type:none;list-style-image:none;margin:0;padding:0}#header .pipelist li{float:left;line-height:1.1em;margin:0 .7em 2px -.7em;padding:0 .7em 0 .7em}#header .pipelist a{text-decoration:none}#header .pipelist a:hover{text-decoration:underline}#content{text-align:left;padding:0 15px 0 15px;padding-bottom:40px}#footer{width:100%;background-color:#f5f5f5;border-top:1px solid #dcdcdc;font-size:.8em;padding-top:8px;padding-bottom:0;color:#696969;white-space:nowrap}img{-ms-interpolation-mode:bicubic}h1{font-weight:700;font-size:1.3em;margin-top:.7em;margin-bottom:1em;border-bottom:1px silver solid;padding-bottom:8px;padding-top:0;color:#1a72b9}h2{font-weight:700;font-size:1.05em;margin-bottom:.25em;color:#1a72b9}h3{font-weight:700;font-size:1em;margin-bottom:.25em;color:#125095}p{margin:0 0 1em 0;line-height:1.5em}li{margin-bottom:4pt}a:active,a:link,a:visited{text-decoration:underline}a:hover{text-decoration:none}table{font-size:1em;margin-top:1em 0 1em 0;border-collapse:collapse;width:90%}tr{vertical-align:top}th{background-color:#edf6ff;vertical-align:bottom;color:#215a8f;padding:5px;border-bottom:1px solid #90adbc}td{vertical-align:top;margin-top:.25em;padding:10px;border-bottom:1px solid #edf6ff}td,th{text-align:left;padding-left:1em;border-right:2px solid #fff}small{font-size:.85em}tt{font-family:monospace;font-size:1.1em}pre{font-family:Consolas,Monaco,'Bitstream Vera Sans Mono','Courier New',Courier,monospace;font-size:1.02em;background-color:#f7f7f7;padding:1px 5px;overflow-x:auto;white-space:pre-wrap;white-space:-moz-pre-wrap!important;white-space:-pre-wrap;white-space:-o-pre-wrap;word-wrap:break-word}.syntax{margin-top:0;margin-left:1em;margin-right:1em;background-color:#f5f5f5}hr{color:silver;background-color:silver;height:1px;border:none}#toc a{font-family:'Segoe UI',Verdana,Arial!important;text-decoration:none!important}#toc a:hover{text-decoration:underline!important}.source .rsbkey{color:#047;font-weight:400}.source .nt{color:#000;font-weight:700}.source .rsbattr{color:maroon;font-weight:700}.source .rsbattrf{color:maroon;font-weight:700}.source .rsbbrace{color:#00f;font-weight:700}.source .rsbform{color:green}.source .rsbop{color:#00f;font-weight:700}.source .s{color:#696969}.source .na{color:#333;font-weight:700}.source .hll{background-color:#ffc}.source .c{color:#408080;font-style:italic}.source .err{border:1px solid red}.source .k{color:green;font-weight:700}.source .o{color:#666}.source .cm{color:#408080;font-style:italic}.source .cp{color:#bc7a00}.source .c1{color:#408080;font-style:italic}.source .cs{color:#408080;font-style:italic}.source .gd{color:#a00000}.source .ge{font-style:italic}.source .gr{color:red}.source .gh{color:navy;font-weight:700}.source .gi{color:#00a000}.source .go{color:grey}.source .gp{color:navy;font-weight:700}.source .gs{font-weight:700}.source .gu{color:purple;font-weight:700}.source .gt{color:#0040d0}.source .kc{color:green;font-weight:700}.source .kd{color:green;font-weight:700}.source .kn{color:green;font-weight:700}.source .kp{color:green}.source .kr{color:green;font-weight:700}.source .kt{color:#b00040}.source .m{color:#666}.source .nb{color:green}.source .nc{color:#00f;font-weight:700}.source .no{color:#800}.source .nd{color:#a2f}.source .ni{color:#999;font-weight:700}.source .ne{color:#d2413a;font-weight:700}.source .nf{color:#00f}.source .nl{color:#a0a000}.source .nn{color:#00f;font-weight:700}.source .nt{color:#333;font-weight:400}.source .nv{color:#19177c}.source .ow{color:#a2f;font-weight:700}.source .w{color:#bbb}.source .mf{color:#666}.source .mh{color:#666}.source .mi{color:#666}.source .mo{color:#666}.source .sb{color:#ba2121}.source .sc{color:#ba2121}.source .sd{color:#ba2121;font-style:italic}.source .s2{color:#ba2121}.source .se{color:#b62;font-weight:700}.source .sh{color:#ba2121}.source .si{color:#b68;font-weight:700}.source .sx{color:green}.source .sr{color:#b68}.source .s1{color:#ba2121}.source .ss{color:#19177c}.source .bp{color:green}.source .vc{color:#19177c}.source .vg{color:#19177c}.source .vi{color:#19177c}.source .il{color:#666}table{width:100%!important}td{white-space:nowrap}td input{width:100%}td:last-child{width:100%}
</style>

<div width="90%">
  <h2>DC Signing Demo - step #1</h2>
  
  <form action="start" method="POST">
    <b>Author:</b><br/>
    <input type="text" name="author" value="Author name" /><br/>
    <b>Reason:</b><br/>
    <input type="text" name="reason" value="Reason" /><br/>
    <b>File path on server:</b><br/>
    <input type="text" name="inputFile" value="c:\temp\pdf\test.pdf" /><br/>
    <input type="submit" value="Start signing" />
  </form>
</div><br/>

<div width="90%" style="${style}">
  <h2>DC Signing Demo - step #2</h2>
  <h5>Please make sure that both DC desktop application and service are running before you press "Sign" button!</h5>
  
  <form id="myForm" method="POST">
    <input type="hidden" id="data" name="data" value="${data}" />
    <input type="submit" value="Sign" />
  </form>
  
  <div id="error"></div>
  <div id="success"></div>
</div><br/>  

<br/>
<br/>
<br/>
<hr/>
NOTE: These pages are simple demos, and by no means complete applications.  They
are intended to illustrate the usage of the SecureBlackbox objects in a simple,
straightforward way.  What we are hoping to demonstrate is how simple it is to
program with our components.  If you want to know more about them, or if you have
questions, please visit <a href="http://www.nsoftware.com/?demopg-SBPFA" target="_blank">www.nsoftware.com</a> or
contact our technical <a href="http://www.nsoftware.com/support/">support</a>.
<br/>
<br/>
Copyright (c) 2020 /n software inc. - All rights reserved.
<br/>
<br/></div>

<div id="footer">
<center>
SecureBlackbox 2020 - Copyright (c) 2020 /n software inc. - All rights reserved. - For more information, please visit our website at <a href="http://www.nsoftware.com/?demopg-SBPFA" target="_blank">www.nsoftware.com</a>.</center></div>

<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
<script>
var login = null;
var pass = "";
var serverUrl = "https://localhost:8888";
var applicationUrl = "http://localhost:10123";
var signFormId = "myForm";
var useSimplePOST = true;

function formToJSON(formId) {
    var formObj = {};
    var inputs = $('#' + formId).serializeArray();

    $.each(inputs, function (i, input) {
        formObj[input.name] = input.value;
    });

    return formObj;
}

function showError(jqXHR, exception) {
    var msg = '';
    if (jqXHR.status === 0) {
        msg = 'DC desktop application does not respond!\n Please check if its running in background.';
    } else if (jqXHR.status == 500) {
        msg = 'Internal Server Error [500]!';
    } else if (jqXHR.status == 404) {
        msg = 'Page not found [404]!';
    } else if (exception === 'timeout') {
        msg = 'Time out error!';
    } else if (exception === 'abort') {
        msg = 'Ajax request aborted!';
    } else {
        msg = 'Uncaught Error.\n' + jqXHR.responseText;
    }
    $('#error').text(msg);
    $('#error').show();
    $("#success").hide();
    
    // reset session
    $.ajax({
      url: applicationUrl + "?reset"
    });
}

function showSuccess(data) {
    $("#success").text("File signed successfully!");
    $('#success').show();
    $('#error').hide();
}

function postServerResponse(response) {
    if (useSimplePOST) {
        var toSend = atob(response.sign);

        $.ajax({
            type: "POST",
            url: applicationUrl + "/result",
            contentType: "text/plain",
            data: toSend,
            processData: false,
            success: function (data) {
                showSuccess(data);
            },
            'error': function (jqXHR, exception) {
                showError(jqXHR, exception);
            }
        });
    } else {
        $.ajax({
            type: "POST",
            url: applicationUrl + "/result",
            contentType: "application/json",
            data: JSON.stringify(response),
            success: function (data) {
                showSuccess(data);
            },
            'error': function (jqXHR, exception) {
                showError(jqXHR, exception);
            }
        });
    }
}

$('#' + signFormId).on('submit', function (event) {
    event.preventDefault();

    if (login != null) {
        $.ajaxSetup({
            headers: {
                'Authorization': "Basic " + btoa(login + ":" + pass)
            }
        });
    }

    var json = formToJSON(signFormId);

    $.ajax({
        type: "POST",
        url: serverUrl + "/sign",
        contentType: "application/json",
        data: JSON.stringify(json),
        crossDomain: true,
        'success': function (data) {
            $('#error').text('');
            postServerResponse(data);
        },
        'error': function (jqXHR, exception) {
            showError(jqXHR, exception);
        }
    });
});

$(document).ready(function () {
    $('#error').hide();
    $('#success').hide();
});
</script>

</body></html>
